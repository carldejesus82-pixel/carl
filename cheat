local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

local function safeLoadURL(url)
    local ok, f = pcall(function()
        return loadstring(game:HttpGet(url))
    end)
    if not ok or type(f) ~= "function" then
        warn("Failed to fetch or load: "..tostring(url))
        return nil
    end
    local sOk, sRet = pcall(f)
    if not sOk then
        warn("Error running loaded code from "..tostring(url)..": "..tostring(sRet))
    end
    return sOk and sRet or nil
end

local gui = Instance.new("ScreenGui")
gui.Name = "3KS_CustomGUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local function addOutline(obj, color)
    local stroke = Instance.new("UIStroke")
    stroke.Thickness = 1.5
    stroke.Color = color or Color3.fromRGB(255,255,255)
    stroke.Parent = obj
end

local function makeScaledText(obj, maxSize)
    obj.TextScaled = true
    local c = Instance.new("UITextSizeConstraint")
    c.MaxTextSize = maxSize or 20
    c.Parent = obj
end

local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 540, 0, 400)
mainFrame.Position = UDim2.new(0.5, -270, 0.5, -200)
mainFrame.BackgroundColor3 = Color3.fromRGB(0,0,0)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Parent = gui
addOutline(mainFrame, Color3.fromRGB(255,255,255))

local dragToggle, dragInput, dragStart, startPos

local function updateDrag(input)
    local delta = input.Position - dragStart
    mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragToggle = true
        dragStart = input.Position
        startPos = mainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragToggle = false
            end
        end)
    end
end)

mainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragToggle then
        updateDrag(input)
    end
end)

local topBar = Instance.new("Frame")
topBar.Name = "TopBar"
topBar.Size = UDim2.new(1,0,0,70)
topBar.Position = UDim2.new(0,0,0,0)
topBar.BackgroundColor3 = Color3.fromRGB(0,0,0)
topBar.BorderSizePixel = 0
topBar.Parent = mainFrame
addOutline(topBar, Color3.fromRGB(255,255,255))

local thumb, ready = Players:GetUserThumbnailAsync(player.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100)
local profileImage = Instance.new("ImageLabel")
profileImage.Name = "ProfileImage"
profileImage.Size = UDim2.new(0,56,0,56)
profileImage.Position = UDim2.new(0,10,0.5,-28)
profileImage.BackgroundTransparency = 1
profileImage.Image = thumb
profileImage.Parent = topBar
addOutline(profileImage, Color3.fromRGB(255,255,255))

local nameLabel = Instance.new("TextLabel")
nameLabel.Name = "NameLabel"
nameLabel.Size = UDim2.new(0,240,0,26)
nameLabel.Position = UDim2.new(0,76,0,8)
nameLabel.BackgroundTransparency = 1
nameLabel.Text = player.Name
nameLabel.TextColor3 = Color3.fromRGB(255,255,255)
nameLabel.Font = Enum.Font.GothamBold
makeScaledText(nameLabel, 20)
nameLabel.TextXAlignment = Enum.TextXAlignment.Left
nameLabel.Parent = topBar

local fpsLabel = Instance.new("TextLabel")
fpsLabel.Name = "FPSLabel"
fpsLabel.Size = UDim2.new(0,160,0,26)
fpsLabel.Position = UDim2.new(1,-170,0,8)
fpsLabel.BackgroundTransparency = 1
fpsLabel.Text = "FPS: 0"
fpsLabel.TextColor3 = Color3.fromRGB(255,255,255)
fpsLabel.Font = Enum.Font.GothamBold
makeScaledText(fpsLabel, 20)
fpsLabel.TextXAlignment = Enum.TextXAlignment.Right
fpsLabel.Parent = topBar

local tabsBar = Instance.new("Frame")
tabsBar.Name = "TabsBar"
tabsBar.Size = UDim2.new(1,0,0,34)
tabsBar.Position = UDim2.new(0,0,0,70)
tabsBar.BackgroundColor3 = Color3.fromRGB(70,70,70)
tabsBar.BorderSizePixel = 0
tabsBar.Parent = mainFrame
addOutline(tabsBar, Color3.fromRGB(200,200,200))

local tabs = {"ROLEPLAY","TROLL","GUNS"}
local tabButtons = {}
local activeTab = "ROLEPLAY"

for i, tname in ipairs(tabs) do
    local btn = Instance.new("TextButton")
    btn.Name = tname.."_Tab"
    btn.Size = UDim2.new(0, 180, 1, 0)
    btn.Position = UDim2.new(0, (i-1)*180, 0, 0)
    btn.BackgroundColor3 = Color3.fromRGB(100,100,100)
    btn.BorderSizePixel = 0
    btn.Text = tname
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Font = Enum.Font.GothamBold
    makeScaledText(btn, 18)
    btn.Parent = tabsBar
    addOutline(btn, Color3.fromRGB(255,255,255))
    tabButtons[tname] = btn
end

local contentHolder = Instance.new("Frame")
contentHolder.Name = "ContentHolder"
contentHolder.Size = UDim2.new(1, -20, 1, -110)
contentHolder.Position = UDim2.new(0,10,0,110)
contentHolder.BackgroundTransparency = 1
contentHolder.Parent = mainFrame

local scroll = Instance.new("ScrollingFrame")
scroll.Name = "ButtonsScroll"
scroll.Size = UDim2.new(1,0,1,0)
scroll.CanvasSize = UDim2.new(0,0,0,0)
scroll.ScrollBarThickness = 6
scroll.BackgroundTransparency = 1
scroll.Parent = contentHolder

local list = Instance.new("UIListLayout")
list.Parent = scroll
list.Padding = UDim.new(0,6)

local buttonsByTab = {}

local function createButton(tabName, text, callback)
    if not buttonsByTab[tabName] then buttonsByTab[tabName] = {} end
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1,-12,0,42)
    btn.BackgroundColor3 = Color3.fromRGB(0,0,0)
    btn.BorderSizePixel = 0
    btn.Text = text
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Font = Enum.Font.Gotham
    makeScaledText(btn, 18)
    btn.Parent = scroll
    addOutline(btn, Color3.fromRGB(255,255,255))
    btn.MouseButton1Click:Connect(function()
        local ok, err = pcall(callback)
        if not ok then warn("Button callback error for "..tostring(text)..": "..tostring(err)) end
    end)
    table.insert(buttonsByTab[tabName], btn)
    btn.Visible = (tabName == activeTab)
    return btn
end

list:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    local y = list.AbsoluteContentSize.Y
    scroll.CanvasSize = UDim2.new(0,0,0, y + 8)
end)

createButton("ROLEPLAY", "INFINITE YIELD", function()
    safeLoadURL("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source")
end)

createButton("ROLEPLAY", "MUSIC EXPO", function()
    safeLoadURL("https://rawscripts.net/raw/Universal-Script-FE-Ac6-Music-Vulnerability-25536")
end)

createButton("ROLEPLAY", "BIG HEAD (toggle)", function()
    _G._3ks_bighead_enabled = not _G._3ks_bighead_enabled
    if not _G._3ks_bighead_enabled then return end
    _G.HeadSize = _G.HeadSize or 4
    if not _G._3ks_bighead_conn then
        _G._3ks_bighead_conn = RunService.RenderStepped:Connect(function()
            if _G._3ks_bighead_enabled then
                for _, pl in ipairs(Players:GetPlayers()) do
                    if pl ~= player and pl.Character and pl.Character:FindFirstChild("Head") then
                        pcall(function()
                            local h = pl.Character.Head
                            h.Size = Vector3.new(_G.HeadSize,_G.HeadSize,_G.HeadSize)
                            h.Transparency = 0.4
                            h.BrickColor = BrickColor.new("Bright red")
                            h.Material = Enum.Material.Neon
                            h.CanCollide = false
                            if h:IsA("BasePart") then
                                h.Massless = true
                            end
                        end)
                    end
                end
            end
        end)
    end
end)

createButton("ROLEPLAY", "FADED MENU", function()
    safeLoadURL("https://raw.githubusercontent.com/NighterEpic/Faded-Grid/main/YesEpic")
end)

createButton("ROLEPLAY", "BRING PARTS", function()
    safeLoadURL("https://raw.githubusercontent.com/Bac0nHck/Scripts/main/BringFlingPlayers")
end)

createButton("ROLEPLAY", "TOUCH FLING", function()
    safeLoadURL("https://rawscripts.net/raw/Universal-Script-Touch-Fling-46156")
end)

createButton("ROLEPLAY", "HITBOX EXPANDER", function()
    safeLoadURL("https://raw.githubusercontent.com/ezsee/Hitbox-Expander123/refs/heads/main/waaaaaat")
end)

createButton("ROLEPLAY", "ESP", function()
    safeLoadURL("https://pastebin.com/raw/4iVTcMZK")
end)

createButton("ROLEPLAY", "BOOST FPS", function()
    pcall(function()
        _G.Ignore = {}
        _G.Settings = {Other = {["FPS Cap"] = 240, ["Low Rendering"] = true}}
    end)
    safeLoadURL("https://raw.githubusercontent.com/CasperFlyModz/discord.gg-rips/main/FPSBooster.lua")
end)

createButton("ROLEPLAY", "DEX EXPLORER", function()
    safeLoadURL("https://raw.githubusercontent.com/MassiveHubs/loadstring/refs/heads/main/DexXenoAndRezware")
end)

createButton("ROLEPLAY", "AIMBOT", function()
    safeLoadURL("https://raw.githubusercontent.com/Exunys/Aimbot-V3/main/src/Aimbot.lua")
end)

createButton("TROLL", "FLING ALL", function()
    safeLoadURL("https://pastebin.com/raw/zqyDSUWX")
end)

createButton("TROLL", "WICKED", function()
    safeLoadURL("https://pastebin.com/raw/GY1wfJRZ")
end)

local function safePurchase(name)
    pcall(function()
        if ReplicatedStorage:FindFirstChild("GunShop") and ReplicatedStorage.GunShop:FindFirstChild("Events") and ReplicatedStorage.GunShop.Events:FindFirstChild("Purchase") then
            ReplicatedStorage.GunShop.Events.Purchase:FireServer(name, -10000)
        else
            warn("GunShop purchase not found")
        end
    end)
end

createButton("GUNS", "ALL CITY HK416", function() safePurchase("HK416") end)
createButton("GUNS", "ALL CITY SP", function() safePurchase("Silenced Pistol") end)
createButton("GUNS", "ALL CITY MEDKIT", function() safePurchase("MEDKIT") end)
createButton("GUNS", "ALL CITY Desert Eagle", function() safePurchase("Desert Deagle") end)
createButton("GUNS", "ALL CITY Glock-17", function() safePurchase("Glock-17") end)
createButton("GUNS", "ALL CITY Glock-19", function() safePurchase("Glock-19") end)
createButton("GUNS", "ALL CITY AK-47", function() safePurchase("AK-47") end)
createButton("GUNS", "ALL CITY BANDAGES", function() safePurchase("BANDAGES") end)
createButton("GUNS", "ALL CITY UZI", function() safePurchase("UZI") end)

local function switchTab(name)
    activeTab = name
    for tab, btlist in pairs(buttonsByTab) do
        for _, b in ipairs(btlist) do
            b.Visible = (tab == name)
        end
    end
    for tname, btn in pairs(tabButtons) do
        if tname == name then
            btn.BackgroundColor3 = Color3.fromRGB(120,120,120)
        else
            btn.BackgroundColor3 = Color3.fromRGB(100,100,100)
        end
    end
end

for tname, btn in pairs(tabButtons) do
    btn.MouseButton1Click:Connect(function()
        switchTab(tname)
    end)
end

switchTab("ROLEPLAY")

local last = tick()
local frames = 0
RunService.RenderStepped:Connect(function()
    frames = frames + 1
    if tick() - last >= 1 then
        fpsLabel.Text = "FPS: ".. tostring(frames)
        frames = 0
        last = tick()
    end
end)

UserInputService.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.KeyCode == Enum.KeyCode.K then
        mainFrame.Visible = not mainFrame.Visible
        mobileToggle.Text = mainFrame.Visible and "Hide" or "Show"
    end
end)

local mobileToggle = Instance.new("TextButton")
mobileToggle.Name = "MobileToggle"
mobileToggle.Size = UDim2.new(0,72,0,26)
mobileToggle.Position = UDim2.new(0.5,-36,0,6)
mobileToggle.BackgroundTransparency = 1
mobileToggle.Text = "Hide"
mobileToggle.TextColor3 = Color3.fromRGB(255,255,255)
mobileToggle.Font = Enum.Font.GothamBold
mobileToggle.TextScaled = true
mobileToggle.Parent = gui
mobileToggle.MouseButton1Click:Connect(function()
    mainFrame.Visible = not mainFrame.Visible
    mobileToggle.Text = mainFrame.Visible and "Hide" or "Show"
end)
            end
        end)
    end
end)

mainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragToggle then
        updateDrag(input)
    end
end)

local topBar = Instance.new("Frame")
topBar.Size = UDim2.new(1, 0, 0, 40)
topBar.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
topBar.BorderColor3 = Color3.fromRGB(255, 255, 255)
topBar.Parent = mainFrame

local profileText = Instance.new("TextLabel")
profileText.Size = UDim2.new(0.5, 0, 1, 0)
profileText.Position = UDim2.new(0, 10, 0, 0)
profileText.BackgroundTransparency = 1
profileText.Text = "Profile: " .. player.Name
profileText.TextColor3 = Color3.fromRGB(255, 255, 255)
profileText.Font = Enum.Font.GothamBold
profileText.TextScaled = true
profileText.TextXAlignment = Enum.TextXAlignment.Left
profileText.Parent = topBar

local fpsLabel = Instance.new("TextLabel")
fpsLabel.Size = UDim2.new(0.5, -10, 1, 0)
fpsLabel.Position = UDim2.new(0.5, 0, 0, 0)
fpsLabel.BackgroundTransparency = 1
fpsLabel.Text = "FPS: 0"
fpsLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
fpsLabel.Font = Enum.Font.GothamBold
fpsLabel.TextScaled = true
fpsLabel.TextXAlignment = Enum.TextXAlignment.Right
fpsLabel.Parent = topBar

local tabsFrame = Instance.new("Frame")
tabsFrame.Size = UDim2.new(1, 0, 0, 30)
tabsFrame.Position = UDim2.new(0, 0, 0, 40)
tabsFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
tabsFrame.BorderColor3 = Color3.fromRGB(255, 255, 255)
tabsFrame.Parent = mainFrame

local contentFrame = Instance.new("ScrollingFrame")
contentFrame.Size = UDim2.new(1, 0, 1, -70)
contentFrame.Position = UDim2.new(0, 0, 0, 70)
contentFrame.CanvasSize = UDim2.new(0, 0, 2, 0)
contentFrame.ScrollBarThickness = 6
contentFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
contentFrame.BorderColor3 = Color3.fromRGB(255, 255, 255)
contentFrame.Parent = mainFrame

local layout = Instance.new("UIListLayout")
layout.Parent = contentFrame
layout.Padding = UDim.new(0, 5)

local function createTabButton(name, posX)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 100, 1, 0)
    btn.Position = UDim2.new(0, posX, 0, 0)
    btn.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    btn.BorderColor3 = Color3.fromRGB(255, 255, 255)
    btn.Text = name
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.GothamBold
    btn.TextScaled = true
    btn.Parent = tabsFrame
    return btn
end

local roleplayBtn = createTabButton("Roleplay", 0)
local trollBtn = createTabButton("Troll", 100)
local gunsBtn = createTabButton("Guns", 200)

local sections = {Roleplay = {}, Troll = {}, Guns = {}}

local function createButton(tab, text, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -10, 0, 40)
    btn.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    btn.BorderColor3 = Color3.fromRGB(255, 255, 255)
    btn.Text = text
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.Gotham
    btn.TextScaled = true
    btn.Parent = contentFrame
    btn.MouseButton1Click:Connect(callback)
    table.insert(sections[tab], btn)
end

createButton("Roleplay", "Infinite Yield", function() loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))() end)
createButton("Roleplay", "ESP", function() print("ESP Activated") end)
createButton("Roleplay", "Aimbot", function() print("Aimbot Activated") end)
createButton("Roleplay", "Faded Menu", function() print("Faded Menu Opened") end)
createButton("Roleplay", "Dex Explorer", function() print("Dex Explorer Opened") end)
createButton("Roleplay", "Music Expo", function() print("Music Expo Loaded") end)
createButton("Roleplay", "FPS Booster", function() print("FPS Booster Activated") end)
createButton("Roleplay", "Big Head", function() print("Big Head Enabled") end)
createButton("Roleplay", "Bring Parts", function() print("Bring Parts Activated") end)
createButton("Roleplay", "Hitbox Expander", function() print("Hitbox Expanded") end)

createButton("Troll", "Fling All", function() print("Fling All Players") end)
createButton("Troll", "Wicked", function() print("Wicked Script Activated") end)

createButton("Guns", "HK416", function() print("Dupe HK416") end)
createButton("Guns", "SP", function() print("Dupe SP") end)
createButton("Guns", "Medkit", function() print("Dupe Medkit") end)
createButton("Guns", "Desert Eagle", function() print("Dupe Deagle") end)
createButton("Guns", "Glock-17", function() print("Dupe Glock-17") end)
createButton("Guns", "Glock-19", function() print("Dupe Glock-19") end)
createButton("Guns", "AK-47", function() print("Dupe AK-47") end)
createButton("Guns", "Bandages", function() print("Dupe Bandages") end)
createButton("Guns", "UZI", function() print("Dupe UZI") end)

local function showTab(tabName)
    for name, buttons in pairs(sections) do
        for _, b in ipairs(buttons) do
            b.Visible = (name == tabName)
        end
    end
end

roleplayBtn.MouseButton1Click:Connect(function() showTab("Roleplay") end)
trollBtn.MouseButton1Click:Connect(function() showTab("Troll") end)
gunsBtn.MouseButton1Click:Connect(function() showTab("Guns") end)

showTab("Roleplay")

local lastUpdate = tick()
local frames = 0
RunService.RenderStepped:Connect(function()
    frames = frames + 1
    if tick() - lastUpdate >= 1 then
        fpsLabel.Text = "FPS: " .. frames
        frames = 0
        lastUpdate = tick()
    end
end)

local mobileToggle = Instance.new("TextButton")
mobileToggle.Size = UDim2.new(0, 80, 0, 25)
mobileToggle.Position = UDim2.new(0.5, -40, 0, 5)
mobileToggle.BackgroundTransparency = 1
mobileToggle.Text = "3KS"
mobileToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
mobileToggle.Font = Enum.Font.GothamBold
mobileToggle.TextScaled = true
mobileToggle.Parent = gui

mobileToggle.MouseButton1Click:Connect(function()
    mainFrame.Visible = not mainFrame.Visible
end)

UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.K then
        mainFrame.Visible = not mainFrame.Visible
    end
end)
