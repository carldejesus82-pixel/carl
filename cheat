local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer

local gui = Instance.new("ScreenGui")
gui.Name = "CustomMenu"
gui.Parent = player:WaitForChild("PlayerGui")

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 400, 0, 300)
mainFrame.Position = UDim2.new(0.5, -200, 0.5, -150)
mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
mainFrame.BorderSizePixel = 2
mainFrame.Parent = gui
mainFrame.Visible = true

-- Draggable
mainFrame.Active = true
mainFrame.Draggable = true

-- Top Bar
local topBar = Instance.new("Frame")
topBar.Size = UDim2.new(1, 0, 0, 30)
topBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
topBar.BorderSizePixel = 1
topBar.Parent = mainFrame

-- Profile
local profileLabel = Instance.new("TextLabel")
profileLabel.Size = UDim2.new(0.5, 0, 1, 0)
profileLabel.Position = UDim2.new(0, 5, 0, 0)
profileLabel.BackgroundTransparency = 1
profileLabel.Text = "Profile: " .. player.Name
profileLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
profileLabel.TextScaled = true
profileLabel.Parent = topBar

-- FPS Counter
local fpsLabel = Instance.new("TextLabel")
fpsLabel.Size = UDim2.new(0.3, 0, 1, 0)
fpsLabel.Position = UDim2.new(0.7, -5, 0, 0)
fpsLabel.BackgroundTransparency = 1
fpsLabel.Text = "FPS: 0"
fpsLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
fpsLabel.TextScaled = true
fpsLabel.Parent = topBar

local lastUpdate = tick()
local frames = 0
RunService.RenderStepped:Connect(function()
    frames = frames + 1
    if tick() - lastUpdate >= 1 then
        fpsLabel.Text = "FPS: " .. tostring(frames)
        frames = 0
        lastUpdate = tick()
    end
end)

-- Tabs
local tabs = {"Roleplay", "Troll", "Guns", "EXP"}
local currentTab = "Roleplay"

local tabButtons = {}
for i, tabName in ipairs(tabs) do
    local tabBtn = Instance.new("TextButton")
    tabBtn.Size = UDim2.new(0, 90, 0, 30)
    tabBtn.Position = UDim2.new(0, (i - 1) * 95 + 5, 0, 35)
    tabBtn.Text = tabName
    tabBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    tabBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    tabBtn.TextScaled = true
    tabBtn.BorderSizePixel = 2
    tabBtn.Parent = mainFrame

    tabButtons[tabName] = tabBtn
    tabBtn.MouseButton1Click:Connect(function()
        currentTab = tabName
        for _, child in ipairs(buttonFrame:GetChildren()) do
            if child:IsA("TextButton") then
                child.Visible = (child:GetAttribute("Tab") == currentTab)
            end
        end
    end)
end

-- Scrolling Frame for Buttons
local buttonFrame = Instance.new("ScrollingFrame")
buttonFrame.Size = UDim2.new(1, -10, 1, -80)
buttonFrame.Position = UDim2.new(0, 5, 0, 70)
buttonFrame.BackgroundTransparency = 1
buttonFrame.BorderSizePixel = 0
buttonFrame.CanvasSize = UDim2.new(0, 0, 5, 0)
buttonFrame.ScrollBarThickness = 8
buttonFrame.Parent = mainFrame

-- Helper function
local function createButton(tab, text, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0.95, 0, 0, 35)
    btn.Position = UDim2.new(0.025, 0, 0, #buttonFrame:GetChildren() * 40)
    btn.Text = text
    btn.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.TextScaled = true
    btn.BorderSizePixel = 2
    btn.Parent = buttonFrame
    btn:SetAttribute("Tab", tab)
    btn.Visible = (tab == currentTab)
    btn.MouseButton1Click:Connect(callback)
end

-- Roleplay Buttons
createButton("Roleplay", "Infinite Yield", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))()
end)
createButton("Roleplay", "Dex Explorer", function()
    loadstring(game:HttpGet("https://cdn.wearedevs.net/scripts/Dex%20Explorer.txt"))()
end)

-- Troll Buttons
createButton("Troll", "Fling All", function()
    print("Fling All Activated")
end)
createButton("Troll", "Wicked Menu", function()
    print("Wicked Activated")
end)

-- Guns Buttons (Dupe Guns example)
createButton("Guns", "Get Glock-17", function()
    print("Give Glock-17")
end)
createButton("Guns", "Get AK-47", function()
    print("Give AK-47")
end)

-- EXP Tab: Track
local trackingEnabled = false
local beams = {}
local nameTags = {}

local function createBeam(target)
    local char = player.Character
    local tChar = target.Character
    if not char or not tChar then return end

    local hrp = char:FindFirstChild("HumanoidRootPart")
    local thrp = tChar:FindFirstChild("HumanoidRootPart")
    if not hrp or not thrp then return end

    local att1 = Instance.new("Attachment", hrp)
    local att2 = Instance.new("Attachment", thrp)

    local beam = Instance.new("Beam")
    beam.Attachment0 = att1
    beam.Attachment1 = att2
    beam.Color = ColorSequence.new(Color3.fromRGB(255, 255, 0))
    beam.Width0 = 0.2
    beam.Width1 = 0.2
    beam.Parent = hrp

    beams[target] = {beam = beam, att1 = att1, att2 = att2}

    local billboard = Instance.new("BillboardGui")
    billboard.Size = UDim2.new(0, 100, 0, 30)
    billboard.Adornee = thrp
    billboard.AlwaysOnTop = true
    billboard.Parent = tChar

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextScaled = true
    label.Text = target.Name
    label.Parent = billboard

    nameTags[target] = billboard
end

local function clearTracking()
    for plr, data in pairs(beams) do
        if data.beam then data.beam:Destroy() end
        if data.att1 then data.att1:Destroy() end
        if data.att2 then data.att2:Destroy() end
    end
    for plr, tag in pairs(nameTags) do
        if tag then tag:Destroy() end
    end
    beams = {}
    nameTags = {}
end

createButton("EXP", "Track", function()
    trackingEnabled = not trackingEnabled
    clearTracking()
    if trackingEnabled then
        for _, plr in ipairs(Players:GetPlayers()) do
            if plr ~= player then
                createBeam(plr)
            end
        end
    end
end)

Players.PlayerAdded:Connect(function(plr)
    if trackingEnabled and plr ~= player then
        createBeam(plr)
    end
end)

Players.PlayerRemoving:Connect(function(plr)
    if beams[plr] then
        clearTracking()
    end
end)

-- Toggle with K key
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.K then
        mainFrame.Visible = not mainFrame.Visible
    end
end)

-- Mobile Toggle
local mobileToggle = Instance.new("TextButton")
mobileToggle.Size = UDim2.new(0, 80, 0, 25)
mobileToggle.Position = UDim2.new(0.5, -40, 0, 5)
mobileToggle.BackgroundTransparency = 1
mobileToggle.Text = "3KS"
mobileToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
mobileToggle.TextScaled = true
mobileToggle.Parent = gui

mobileToggle.MouseButton1Click:Connect(function()
    mainFrame.Visible = not mainFrame.Visible
end)
